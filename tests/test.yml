---
- hosts: all

  vars:
    php_versions:
    - 5.6

  tasks:

  - name: Set php_versions for Ubuntu
    set_fact:
      php_versions:
      - 5.6
      - 7.0
      - 7.1
      - 7.2
    when: ansible_distribution == "Ubuntu"

  - name: Add PPA for latest php
    apt_repository:
      repo: ppa:ondrej/php
    when: ansible_distribution == "Ubuntu"

  - name: install git
    apt:
      name: git

  - name: Install PHP development files
    apt:
      name: php{{ item }}-dev
    with_items: '{{ php_versions }}'
    when: ansible_distribution == "Ubuntu"

  - name: Install PHP development files
    apt:
      name: php5-dev
    with_items: '{{ php_versions }}'
    when: ansible_distribution == "Debian"

  - include_role:
      name: role_under_test
    with_items: '{{ php_versions }}'
    loop_control:
      loop_var: jsmin_php_version
